{% extends "base.html" %}
{% block title %}Setup 2FA{% endblock %}
{% block content %}
<div class="card shadow-lg">
    <div class="card-body p-4 p-md-5">
        <h1 class="card-title text-center mb-4 fw-bold">Setup 2FA</h1>
        <p class="text-center lead mb-4">Scan the QR code with your authenticator app or manually enter the setup key.</p>
        <div class="text-center my-4">
            {% if qr_code_data %}
                <div class="d-inline-block rounded border border-secondary" style="background-color: white; padding: 10px;"> {# White bg for QR #}
                    <img src="{{ qr_code_data }}" alt="Authenticator QR Code" class="img-fluid" style="max-width: 220px;">
                </div>
            {% else %}
                <div class="alert alert-danger">Error generating QR code.</div>
            {% endif %}
        </div>
        <div class="text-center mb-4">
            <label class="form-label d-block">Setup Key (Keep Safe!)</label>
            <code class="user-select-all bg-secondary-subtle p-2 rounded border d-inline-block my-1 fs-5">{{ secret_key }}</code>
        </div>
        <hr class="my-4">
        <p class="text-center lead mb-4">Enter the 6-digit code generated by your app to verify.</p>
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                 <form method="POST" action="{{ url_for('setup_2fa') }}">
                    <input type="hidden" name="secret_key" value="{{ secret_key }}">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="totp_code" name="totp_code" required placeholder="6-Digit Code" autocomplete="one-time-code" inputmode="numeric" pattern="\d{6}" minlength="6" maxlength="6" title="Enter 6-digit code">
                         <label for="totp_code">Verification Code</label>
                    </div>
                    <div class="d-grid mt-4">
                         <button type="submit" class="btn btn-success btn-lg"><i class="bi bi-shield-check"></i> Verify and Enable 2FA</button>
                    </div>
                </form>
             </div>
        </div>
         <p class="mt-4 text-center"><a href="{{ url_for('vault') }}" class="link-secondary">Cancel Setup</a></p>
    </div>
</div>
{% endblock %}