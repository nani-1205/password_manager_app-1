{% extends "base.html" %}

{% block title %}Setup Two-Factor Authentication{% endblock %}

{% block content %}
<div class="card shadow-sm">
    <div class="card-body p-4">
        <h1 class="card-title text-center mb-4">Setup Two-Factor Authentication</h1>

        <p class="text-center">Scan the QR code below with your authenticator app (e.g., Google Authenticator, Authy). <br> If you cannot scan, manually enter the setup key.</p>

        <div class="text-center my-4"> {# Center QR Code #}
            {% if qr_code_data %}
                <img src="{{ qr_code_data }}" alt="Authenticator QR Code" class="img-fluid" style="max-width: 250px; border: 1px solid #dee2e6; padding: 5px;">
            {% else %}
                <div class="alert alert-danger" role="alert">Error generating QR code.</div>
            {% endif %}
        </div>

        <div class="text-center mb-4">
            <strong>Setup Key:</strong>
            <code class="user-select-all bg-light p-1 rounded border d-inline-block my-1">{{ secret_key }}</code> {# Make key selectable #}
            <br><small class="text-muted">(Keep this key safe as a backup!)</small>
        </div>

        <hr class="my-4">

        <p class="text-center">After adding the key to your app, enter the 6-digit code it generates below to verify and enable 2FA.</p>

        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                 <form method="POST" action="{{ url_for('setup_2fa') }}">
                    {# Pass the generated secret back to the server for verification #}
                    <input type="hidden" name="secret_key" value="{{ secret_key }}">
                    <div class="mb-3">
                        <label for="totp_code" class="form-label">Verification Code:</label>
                        <input type="text" class="form-control" id="totp_code" name="totp_code" required autocomplete="one-time-code" inputmode="numeric" pattern="\d{6}" minlength="6" maxlength="6" title="Enter 6-digit code">
                    </div>
                    <div class="d-grid">
                         <button type="submit" class="btn btn-primary">Verify and Enable 2FA</button>
                    </div>
                </form>
             </div>
        </div>

         <p class="mt-3 text-center"><a href="{{ url_for('vault') }}">Cancel Setup</a></p>
    </div>
</div>
{% endblock %}