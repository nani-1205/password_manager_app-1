{% extends "logged_in_base_v2.html" %} {# <-- USE THE CORRECT LOGGED IN BASE TEMPLATE #}

{% block title %}Vault Dashboard{% endblock %}

{% block main_content %} {# Content goes into the main_content block defined in logged_in_base_v2.html #}
    <div class="content"> {# This div provides padding and scroll defined in quantum-v2.css #}

        {# Optional: Add a title specific to this content area if needed #}
        {# <h2 class="section-title">Stored Entries {% if search_term %}<span style="font-size: 0.8em; color: var(--text-secondary);">(Filtered)</span>{% endif %}</h2> #}

        <div class="entries-grid"> {# Grid layout for the cards #}
            {% if entries %}
                {% for entry in entries %}
                <div class="entry-card">
                    {# Icon based on first letter #}
                    <div class="entry-icon">
                        {{ (entry.brand_label or entry.laptop_server or '?')[0]|upper }}
                    </div>

                    {# Main details section #}
                    <div class="entry-details">
                        <div class="entry-title">{{ entry.laptop_server }}</div>
                        {% if entry.brand_label %}
                            <div class="entry-brand">{{ entry.brand_label }}</div>
                        {% endif %}
                        <div class="entry-credential">
                           <i class="bi bi-person"></i> {{ entry.entry_username }}
                        </div>
                        <div class="entry-password-area">
                            <span class="password-mask" id="dots-{{ entry._id | string }}">••••••••••••</span>
                            <span class="password-revealed" id="text-{{ entry._id | string }}" style="display: none;"></span> {# JS populates this #}
                            <button type="button" class="action-btn show-stored-btn" data-id="{{ entry._id | string }}" title="Show/Hide Password">
                                 <i class="bi bi-eye-fill"></i> {# Icon changes via JS #}
                             </button>
                        </div>
                    </div>

                    {# Action buttons (appear on hover via CSS) #}
                    <div class="entry-actions">
                         {# Add Edit button placeholder if needed later
                         <button class="action-btn edit-btn" data-id="{{ entry._id | string }}" title="Edit"><i class="bi bi-pencil-fill"></i></button>
                         #}
                        <button type="button" class="action-btn copy-btn" data-id="{{ entry._id | string }}" title="Copy Password"><i class="bi bi-clipboard-fill"></i></button>
                        <form method="POST" action="{{ url_for('delete_entry', entry_id=entry._id) }}" class="d-inline">
                             <button type="submit" class="action-btn delete-btn" onclick="return confirm('Delete entry for \'{{ entry.laptop_server }}\'?');" title="Delete Entry"><i class="bi bi-trash-fill"></i></button>
                         </form>
                    </div>
                </div> {# End entry-card #}
                {% endfor %}
            {% else %}
                 {# Message shown when no entries match search or vault is empty #}
                 <div class="alert alert-info mt-3" style="grid-column: 1 / -1;"> {# Span full grid width #}
                     {% if search_term %}
                        No entries found matching your search criteria. <a href="{{ url_for('vault') }}" class="alert-link">Clear Search</a>
                     {% else %}
                        Your vault is empty. Click the "+ Add Entry" button in the header above to add items.
                     {% endif %}
                 </div>
            {% endif %}
        </div> {# End entries-grid #}
    </div> {# End content #}

    {# Include the Add Entry Modal (defined in its own partial file) #}
    {% include 'partials/_add_entry_modal.html' %}

{% endblock %} {# End main_content block #}

{% block scripts %}
    {# Link the JavaScript specific to this vault layout #}
    <script src="{{ url_for('static', filename='js/vault-v2.js') }}"></script>
{% endblock %}